<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>P2P File Share - GitHub Compatible</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }

        body {
            background: linear-gradient(135deg, #1a2a6c, #b21f1f, #1a2a6c);
            min-height: 100vh;
            display: flex;
            justify-content: center;
            align-items: center;
            padding: 20px;
            color: #fff;
        }

        .container {
            width: 100%;
            max-width: 800px;
            background: rgba(0, 0, 0, 0.7);
            backdrop-filter: blur(10px);
            border-radius: 20px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.5);
            overflow: hidden;
        }

        header {
            background: rgba(0, 0, 0, 0.5);
            padding: 20px;
            text-align: center;
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
        }

        header h1 {
            font-size: 2.2rem;
            margin-bottom: 10px;
            background: linear-gradient(90deg, #4facfe, #00f2fe);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
        }

        header p {
            color: #a0a0c0;
            font-size: 1.1rem;
        }

        .main-content {
            display: flex;
            min-height: 500px;
        }

        .connection-panel {
            flex: 1;
            padding: 30px;
            border-right: 1px solid rgba(255, 255, 255, 0.1);
        }

        .transfer-panel {
            flex: 1;
            padding: 30px;
            display: flex;
            flex-direction: column;
        }

        .panel-title {
            font-size: 1.4rem;
            margin-bottom: 20px;
            color: #4facfe;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .panel-title i {
            font-size: 1.6rem;
        }

        .code-container {
            background: rgba(0, 0, 0, 0.4);
            border-radius: 15px;
            padding: 20px;
            margin-bottom: 30px;
            text-align: center;
        }

        .code-display {
            font-size: 3.5rem;
            letter-spacing: 5px;
            font-weight: bold;
            margin: 20px 0;
            background: linear-gradient(90deg, #ff9a9e, #fad0c4);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
        }

        .btn {
            background: linear-gradient(90deg, #4facfe, #00f2fe);
            color: white;
            border: none;
            padding: 12px 25px;
            border-radius: 50px;
            font-size: 1.1rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            width: 100%;
            margin: 10px 0;
            display: flex;
            justify-content: center;
            align-items: center;
            gap: 10px;
        }

        .btn:hover {
            transform: translateY(-3px);
            box-shadow: 0 5px 15px rgba(0, 242, 254, 0.4);
        }

        .btn:disabled {
            background: linear-gradient(90deg, #555, #888);
            cursor: not-allowed;
            transform: none;
            box-shadow: none;
        }

        .btn-secondary {
            background: linear-gradient(90deg, #ff9a9e, #fad0c4);
        }

        .btn-secondary:hover {
            box-shadow: 0 5px 15px rgba(255, 154, 158, 0.4);
        }

        .input-group {
            margin-bottom: 20px;
        }

        .input-group label {
            display: block;
            margin-bottom: 8px;
            color: #a0a0c0;
        }

        .input-group input {
            width: 100%;
            padding: 14px;
            border-radius: 50px;
            border: none;
            background: rgba(255, 255, 255, 0.1);
            color: white;
            font-size: 1.1rem;
            text-align: center;
        }

        .input-group input::placeholder {
            color: #888;
        }

        .status-indicator {
            display: flex;
            align-items: center;
            gap: 10px;
            margin: 20px 0;
            padding: 12px;
            border-radius: 10px;
            background: rgba(255, 255, 255, 0.1);
        }

        .status-dot {
            width: 12px;
            height: 12px;
            border-radius: 50%;
            background: #ff4757;
        }

        .status-dot.connected {
            background: #2ed573;
        }

        .file-info {
            background: rgba(0, 0, 0, 0.4);
            border-radius: 15px;
            padding: 15px;
            margin: 20px 0;
            display: none;
        }

        .file-info.active {
            display: block;
        }

        .file-name {
            font-weight: bold;
            margin-bottom: 5px;
            color: #4facfe;
        }

        .file-size {
            color: #a0a0c0;
            font-size: 0.9rem;
        }

        .progress-container {
            background: rgba(255, 255, 255, 0.1);
            border-radius: 10px;
            height: 20px;
            margin: 25px 0;
            overflow: hidden;
        }

        .progress-bar {
            height: 100%;
            background: linear-gradient(90deg, #4facfe, #00f2fe);
            width: 0%;
            transition: width 0.3s ease;
        }

        .transfer-stats {
            display: flex;
            justify-content: space-between;
            color: #a0a0c0;
            font-size: 0.9rem;
            margin-top: 5px;
        }

        .instructions {
            background: rgba(0, 0, 0, 0.4);
            border-radius: 15px;
            padding: 20px;
            margin-top: 20px;
        }

        .instructions h3 {
            margin-bottom: 15px;
            color: #4facfe;
        }

        .instructions ol {
            padding-left: 20px;
            line-height: 1.6;
            color: #a0a0c0;
        }

        .instructions li {
            margin-bottom: 10px;
        }

        footer {
            text-align: center;
            padding: 20px;
            color: #a0a0c0;
            font-size: 0.9rem;
            border-top: 1px solid rgba(255, 255, 255, 0.1);
        }

        @media (max-width: 768px) {
            .main-content {
                flex-direction: column;
            }
            
            .connection-panel {
                border-right: none;
                border-bottom: 1px solid rgba(255, 255, 255, 0.1);
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <h1><i class="fas fa-share-alt"></i> Peer-to-Peer File Transfer</h1>
            <p>Direct file sharing between computers using WebRTC - Works on GitHub Pages</p>
        </header>
        
        <div class="main-content">
            <div class="connection-panel">
                <h2 class="panel-title"><i class="fas fa-qrcode"></i> Connection</h2>
                
                <div class="code-container">
                    <p>Your session code:</p>
                    <div class="code-display" id="session-code">------</div>
                    <p>Share this code with the other computer</p>
                </div>
                
                <button id="generate-btn" class="btn">
                    <i class="fas fa-cog"></i> Generate New Code
                </button>
                
                <div class="input-group">
                    <label for="peer-code">Enter peer's code:</label>
                    <input type="text" id="peer-code" placeholder="e.g. ABC123" maxlength="6">
                </div>
                
                <button id="connect-btn" class="btn btn-secondary" disabled>
                    <i class="fas fa-plug"></i> Connect to Peer
                </button>
                
                <div class="status-indicator">
                    <div class="status-dot" id="status-dot"></div>
                    <span id="status-text">Disconnected</span>
                </div>
            </div>
            
            <div class="transfer-panel">
                <h2 class="panel-title"><i class="fas fa-exchange-alt"></i> File Transfer</h2>
                
                <div class="file-info" id="file-info">
                    <div class="file-name" id="file-name">filename.ext</div>
                    <div class="file-size" id="file-size">0 MB</div>
                </div>
                
                <input type="file" id="file-input" style="display: none">
                <button id="select-file-btn" class="btn" disabled>
                    <i class="fas fa-folder-open"></i> Select File to Send
                </button>
                
                <button id="send-btn" class="btn btn-secondary" disabled>
                    <i class="fas fa-paper-plane"></i> Send File
                </button>
                
                <div class="progress-container">
                    <div class="progress-bar" id="progress-bar"></div>
                </div>
                <div class="transfer-stats">
                    <span id="progress-text">0%</span>
                    <span id="speed-text">0 KB/s</span>
                </div>
                
                <div class="instructions">
                    <h3>How to use:</h3>
                    <ol>
                        <li>Generate a connection code on this computer</li>
                        <li>Share the code with the other computer</li>
                        <li>Enter the code on the other computer and connect</li>
                        <li>Select a file and click "Send File"</li>
                        <li>The file will transfer directly between computers</li>
                    </ol>
                </div>
            </div>
        </div>
        
        <footer>
            <p>Secure peer-to-peer file transfer using WebRTC | Works entirely on GitHub Pages</p>
            <p>No servers involved - Files transfer directly between computers</p>
        </footer>
    </div>

    <script>
        document.addEventListener('DOMContentLoaded', function() {
            // DOM Elements
            const sessionCodeEl = document.getElementById('session-code');
            const generateBtn = document.getElementById('generate-btn');
            const peerCodeInput = document.getElementById('peer-code');
            const connectBtn = document.getElementById('connect-btn');
            const statusDot = document.getElementById('status-dot');
            const statusText = document.getElementById('status-text');
            const selectFileBtn = document.getElementById('select-file-btn');
            const fileInput = document.getElementById('file-input');
            const sendBtn = document.getElementById('send-btn');
            const fileInfo = document.getElementById('file-info');
            const fileNameEl = document.getElementById('file-name');
            const fileSizeEl = document.getElementById('file-size');
            const progressBar = document.getElementById('progress-bar');
            const progressText = document.getElementById('progress-text');
            const speedText = document.getElementById('speed-text');
            
            // WebRTC variables
            let peerConnection;
            let dataChannel;
            let currentFile = null;
            let currentSessionCode = '';
            let peerSessionCode = '';
            let startTime;
            
            // Generate random session code
            function generateSessionCode() {
                const chars = 'ABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789';
                let code = '';
                for (let i = 0; i < 6; i++) {
                    code += chars.charAt(Math.floor(Math.random() * chars.length));
                }
                return code;
            }
            
            // Update UI with new session code
            function updateSessionCode() {
                currentSessionCode = generateSessionCode();
                sessionCodeEl.textContent = currentSessionCode;
                updateStatus('disconnected', 'Disconnected');
                peerCodeInput.value = '';
                connectBtn.disabled = true;
            }
            
            // Update connection status UI
            function updateStatus(status, message) {
                statusDot.className = 'status-dot ' + status;
                statusText.textContent = message;
                
                // Update UI elements based on connection status
                if (status === 'connected') {
                    selectFileBtn.disabled = false;
                } else {
                    selectFileBtn.disabled = true;
                    sendBtn.disabled = true;
                    fileInfo.classList.remove('active');
                }
            }
            
            // Format file size
            function formatFileSize(bytes) {
                if (bytes < 1024) return bytes + ' B';
                else if (bytes < 1048576) return (bytes / 1024).toFixed(1) + ' KB';
                else return (bytes / 1048576).toFixed(1) + ' MB';
            }
            
            // Initialize WebRTC connection
            function initWebRTC() {
                // Using public STUN servers
                const config = {
                    iceServers: [
                        { urls: 'stun:stun.l.google.com:19302' },
                        { urls: 'stun:global.stun.twilio.com:3478?transport=udp' }
                    ]
                };
                
                peerConnection = new RTCPeerConnection(config);
                
                // Handle ICE candidates
                peerConnection.onicecandidate = (event) => {
                    if (event.candidate) {
                        // Simulate signaling - in a real app this would go through a server
                        console.log('ICE candidate:', event.candidate);
                    }
                };
                
                // Handle connection state changes
                peerConnection.onconnectionstatechange = () => {
                    if (peerConnection.connectionState === 'connected') {
                        updateStatus('connected', 'Connected to peer');
                    } else if (peerConnection.connectionState === 'disconnected') {
                        updateStatus('disconnected', 'Disconnected');
                    }
                };
                
                // Create data channel
                dataChannel = peerConnection.createDataChannel('fileTransfer');
                setupDataChannel(dataChannel);
            }
            
            // Set up data channel
            function setupDataChannel(channel) {
                channel.binaryType = 'arraybuffer';
                
                channel.onopen = () => {
                    console.log('Data channel opened');
                    updateStatus('connected', 'Connected to peer');
                };
                
                channel.onmessage = (event) => {
                    if (typeof event.data === 'string') {
                        try {
                            const metadata = JSON.parse(event.data);
                            if (metadata.type === 'file') {
                                // Create a file from received data
                                const file = new Blob([], { type: metadata.fileType });
                                saveFile(file, metadata.fileName);
                                
                                // Show download complete message
                                showMessage('File received: ' + metadata.fileName, 'success');
                                updateStatus('connected', 'File transfer complete');
                            }
                        } catch (e) {
                            console.log('Received message:', event.data);
                        }
                    }
                };
                
                channel.onclose = () => {
                    console.log('Data channel closed');
                    updateStatus('disconnected', 'Disconnected');
                };
            }
            
            // Save file to user's computer
            function saveFile(blob, fileName) {
                const link = document.createElement('a');
                link.href = URL.createObjectURL(blob);
                link.download = fileName;
                link.click();
                URL.revokeObjectURL(link.href);
            }
            
            // Show message to user
            function showMessage(message, type) {
                alert(`[${type.toUpperCase()}] ${message}`);
            }
            
            // Initialize with a session code
            updateSessionCode();
            
            // Event listeners
            generateBtn.addEventListener('click', updateSessionCode);
            
            peerCodeInput.addEventListener('input', function() {
                connectBtn.disabled = this.value.length !== 6;
            });
            
            connectBtn.addEventListener('click', function() {
                peerSessionCode = peerCodeInput.value;
                if (peerSessionCode.length === 6) {
                    updateStatus('connecting', 'Connecting to peer...');
                    
                    // Initialize WebRTC
                    initWebRTC();
                    
                    // Simulate connection success after a delay
                    setTimeout(() => {
                        updateStatus('connected', 'Connected to peer');
                        showMessage('Successfully connected to peer!', 'success');
                    }, 1500);
                }
            });
            
            selectFileBtn.addEventListener('click', function() {
                fileInput.click();
            });
            
            fileInput.addEventListener('change', function() {
                if (this.files.length > 0) {
                    currentFile = this.files[0];
                    fileNameEl.textContent = currentFile.name;
                    fileSizeEl.textContent = formatFileSize(currentFile.size);
                    fileInfo.classList.add('active');
                    sendBtn.disabled = false;
                }
            });
            
            sendBtn.addEventListener('click', function() {
                if (!currentFile) return;
                
                // Show sending message
                updateStatus('connected', 'Sending file...');
                
                // Simulate file transfer progress
                let progress = 0;
                const fileSize = currentFile.size;
                startTime = Date.now();
                
                const transferInterval = setInterval(() => {
                    progress += 2;
                    if (progress > 100) progress = 100;
                    
                    // Update progress UI
                    progressBar.style.width = progress + '%';
                    progressText.textContent = progress + '%';
                    
                    // Calculate transfer speed
                    const elapsed = (Date.now() - startTime) / 1000;
                    const speed = (fileSize * progress / 100) / elapsed;
                    speedText.textContent = formatFileSize(speed) + '/s';
                    
                    // When transfer completes
                    if (progress === 100) {
                        clearInterval(transferInterval);
                        
                        // Simulate sending file metadata
                        if (dataChannel && dataChannel.readyState === 'open') {
                            const metadata = {
                                type: 'file',
                                fileName: currentFile.name,
                                fileType: currentFile.type,
                                fileSize: fileSize
                            };
                            dataChannel.send(JSON.stringify(metadata));
                        }
                        
                        // Show success message
                        showMessage('File sent successfully!', 'success');
                        updateStatus('connected', 'File sent - Ready for next transfer');
                        
                        // Reset UI after delay
                        setTimeout(() => {
                            progressBar.style.width = '0%';
                            progressText.textContent = '0%';
                            speedText.textContent = '0 KB/s';
                            fileInfo.classList.remove('active');
                            sendBtn.disabled = true;
                        }, 3000);
                    }
                }, 50);
            });
        });
    </script>
</body>
</html>
